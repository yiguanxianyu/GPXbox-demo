(function(){"use strict";var e={533:function(e,t,n){var o=n(9242),a=n(3396),l=n(4870),i=n(3153),r=n.n(i);n(8847);const s={id:"map"};var u={setup(e){let t,n,o,l,i,u,c,m,p=1,d=[];const f=()=>{t=r().map("map",{center:[39.99,116.303],zoom:15,attributionControl:!1})},g=e=>{r().control.scale({maxWidth:100,metric:!0,imperial:!1}).addTo(e)},h=e=>{let t="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";r().tileLayer(t,{minZoom:7,maxZoom:19}).addTo(e)},v=()=>{},b=(0,a.FN)().appContext.config.globalProperties;return b.$bus.$on("fileRead",v),b.$bus.$on("speedRatioChanged",(e=>{p=e})),b.$bus.$on("sendPolyline",(e=>{n.setLatLngs(e.polyline),o.setPaths(e.polyline),t.fitBounds(n.getBounds()),void 0===i?i=r().polyline([{lat:e.polyline[0][0],lon:e.polyline[0][1]}],{smoothFactor:.5,weight:4,color:"#ff6500"}).addTo(t):i.setLatLngs([{lat:e.polyline[0][0],lon:e.polyline[0][1]}]),l=0,u=e.polyline.length,m=e.timeDelta;let a=new Array(u);for(let t=0;t<u;t++){let n=e.polyline[t];a[t]={lat:n[0],lon:n[1]}}c=a})),b.$bus.$on("play",(()=>{let e=()=>{l<u-1&&(i.addLatLng(c[l]),d.push(setTimeout(e,m[l]/p)),l++)};d.push(setTimeout(e,0))})),b.$bus.$on("pause",(()=>{for(let e=0,t=d.length;e<t;e++)clearTimeout(d[e])})),b.$bus.$on("backToStart",(()=>{l=0;let e=i.getLatLngs()[0];i.setLatLngs([e])})),(0,a.bv)((()=>{f(),g(t),h(t),n=r().polyline([],{smoothFactor:.5,weight:4,color:"#00ad53"}).addTo(t),o=r().polylineDecorator([],{patterns:[{repeat:50,symbol:r().Symbol.arrowHead({pixelSize:5,headAngle:75,polygon:!1,pathOptions:{stroke:!0,weight:2,color:"#f5f5dc"}})}]}).addTo(t)})),(e,t)=>((0,a.wg)(),(0,a.iD)("div",s))}};const c=u;var m=c,p=n(7139),d=n(7238),f=n(235);const g=(0,a.Uk)("打开 GPX");var h={setup(e){let t=(0,l.iH)(null);const n=(0,a.FN)().appContext.config.globalProperties,o=({file:e})=>(n.$bus.$emit("fileRead",e.file),n.$bus.$emit("fileTitleRead",e.file.name),!1);return(e,n)=>((0,a.wg)(),(0,a.j4)((0,l.SU)(d.Z),{ref_key:"uploader",ref:t,accept:".gpx",max:1,onBeforeUpload:o},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(f.Z),{color:"#149D1F",primary:"",strong:""},{default:(0,a.w5)((()=>[g])),_:1})])),_:1},512))}};const v=h;var b=v,y=n(4722),S=n(1176),U=n(2505),w=n(9163),x=n(4299),$=n(7541),k=n(4470),_=n(5672),P=n(4567),A=n(9398),Z=n(301),W=n(4786),D=n(1260),T=n(2703),L=n(6296),C=n(3144),H=n(3645),F=n(8491),M=n(7108),O=n(5210),j=n(8870);const N=(0,a.Uk)("  播放 "),K=(0,a.Uk)("  暂停 "),z=(0,a.Uk)("  倒放 "),R=(0,a.Uk)("  回到起点 "),G=(0,a.Uk)("  速度单位 "),I=(0,a.Uk)(" 倍速 "),B=(0,a.Uk)(" 允许设置的倍速范围为 0.1 ~ 5 "),X=(0,a.Uk)("总里程"),E=(0,a.Uk)("总时间"),J=(0,a.Uk)("平均速度"),Y=(0,a.Uk)("记录点数量");var q={setup(e){const t=e=>()=>(0,a.h)(W.g,null,{default:()=>(0,a.h)(e)});let n,o,i=0;const r=(0,l.iH)(),s=(0,l.iH)(500),u=(0,l.iH)(),c=(0,l.iH)(),m=(0,l.iH)(),d=(0,l.iH)(),g=(0,D.U)(),h=t(y.Z),v=(0,a.FN)().appContext.config.globalProperties;v.$bus.$on("statsData",(e=>{o=e,o.totalDistance>=1e4?u.value=(o.totalDistance/1e3).toFixed(2)+"km":u.value=o.totalDistance+"m",c.value=o.totalTime,d.value=o.numPoints,n=o.meanSpeed,m.value=n[i]}));const q=(0,l.iH)([{label:"m/s",key:0,icon:h},{label:"km/h",key:1},{label:"min/km (Experimental)",key:2}]);function Q(e){for(let t=0;t<3;t++)q.value[t].icon=null;q.value[e].icon=h,v.$bus.$emit("unitOfSpeedChanged",e),m.value=n[e]}function V(e){null!==e&&(v.$bus.$emit("speedRatioChanged",e),g.info("调整为"+e+"倍速"),r.value=e)}function ee(){v.$bus.$emit("play")}function te(){v.$bus.$emit("pause")}function ne(){v.$bus.$emit("backToStart")}return(e,t)=>((0,a.wg)(),(0,a.j4)((0,l.SU)(T.Z),{justify:"space-around",vertical:""},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(L.ZP),{id:"title",bordered:!1,"header-style":"font-size:2.5em",title:"GPXbox"}),(0,a.Wm)((0,l.SU)(T.Z),{justify:"space-evenly"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(b)),(0,a.Wm)((0,l.SU)(f.Z),{secondary:"",strong:"",onClick:ee},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(S.Z)},null,8,["component"]),N])),_:1}),(0,a.Wm)((0,l.SU)(f.Z),{secondary:"",strong:"",onClick:te},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(U.Z)},null,8,["component"]),K])),_:1})])),_:1}),(0,a.Wm)((0,l.SU)(T.Z),{justify:"space-evenly"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(f.Z),{secondary:"",strong:"",onClick:ee},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(w.Z)},null,8,["component"]),z])),_:1}),(0,a.Wm)((0,l.SU)(f.Z),{secondary:"",strong:"",onClick:ne},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(x.Z)},null,8,["component"]),R])),_:1}),(0,a.Wm)((0,l.SU)(C.Z),{options:q.value,trigger:"hover",onSelect:Q},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(f.Z),{secondary:"",strong:""},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)($.Z)},null,8,["component"]),G])),_:1})])),_:1},8,["options"])])),_:1}),(0,a.Wm)((0,l.SU)(H.Z),{trigger:"hover"},{trigger:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(F.Z),{id:"inputNumber","default-value":1,max:5,min:.1,value:r.value,"onUpdate:value":V},{suffix:(0,a.w5)((()=>[I])),prefix:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(k.Z),depth:1},null,8,["component"])])),_:1},8,["min","value"])])),default:(0,a.w5)((()=>[B])),_:1}),(0,a.Wm)((0,l.SU)(M.Z),{cols:2,"x-gap":"4"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(O.ZP),{class:"statsLabel"},{default:(0,a.w5)((()=>[X])),_:1}),(0,a.Wm)((0,l.SU)(O.ZP),{class:"statsLabel"},{default:(0,a.w5)((()=>[E])),_:1}),(0,a.Wm)((0,l.SU)(O.ZP),{class:"statsData"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(_.Z)},null,8,["component"]),(0,a.Uk)(" "+(0,p.zw)(u.value),1)])),_:1}),(0,a.Wm)((0,l.SU)(O.ZP),{class:"statsData"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(P.Z)},null,8,["component"]),(0,a.Uk)(" "+(0,p.zw)(c.value),1)])),_:1}),(0,a.Wm)((0,l.SU)(O.ZP),{class:"statsLabel"},{default:(0,a.w5)((()=>[J])),_:1}),(0,a.Wm)((0,l.SU)(O.ZP),{class:"statsLabel"},{default:(0,a.w5)((()=>[Y])),_:1}),(0,a.Wm)((0,l.SU)(O.ZP),{class:"statsData"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(A.Z)},null,8,["component"]),(0,a.Uk)(" "+(0,p.zw)(m.value),1)])),_:1}),(0,a.Wm)((0,l.SU)(O.ZP),{class:"statsData"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(Z.Z)},null,8,["component"]),(0,a.Uk)(" "+(0,p.zw)(d.value),1)])),_:1})])),_:1}),(0,a.Wm)((0,l.SU)(j.Z),{id:"slider",value:s.value,"onUpdate:value":t[0]||(t[0]=e=>s.value=e),"format-tooltip":e=>e/10+"%",max:1e3,step:1,placement:"bottom"},null,8,["value","format-tooltip"])])),_:1}))}};const Q=q;var V=Q,ee=n(3215),te=n(8720),ne=n(5977),oe=n(7031),ae=n(6069),le=n(9483),ie=n(7309),re=n(542),se=n(2015),ue=n(7103),ce=n(5381),me=n(7049),pe=n(1068),de=n.n(pe);function fe(e){let t=e.length;if(void 0===t)return e;{let n=0;for(let o=0;o<t;o++)n+=e[o];return n/t}}function ge(e){const t=new Date(e);let n=t.getFullYear(),o=t.getMonth()+1,a=t.getDate(),l=t.getHours(),i=t.getMinutes(),r=t.getSeconds();return o=o>9?o:"0"+o,a=a>9?a:"0"+a,l=l>9?l:"0"+l,i=i>9?i:"0"+i,r=r>9?r:"0"+r,`${n}-${o}-${a} ${l}:${i}:${r}`}function he(e){e/=1e3;const t=parseInt(e/3600),n=parseInt(e/60%60),o=Math.ceil(e%60),a=t<10?"0"+t:t,l=o>59?59:o;return`${a>0?`${a}:`:""}${n<10?"0"+n:n}:${l<10?"0"+l:l}`}function ve(e){let t=new(de());t.parse(e);let n,o,a=t.tracks[0],l=a.distance.cumul,i=a.points,r=i.map((e=>+e.time)),s=l.length,u=new Array(s);for(let c=0;c<s-2;c++)n=l[c+2]-l[c],o=r[c+2]-r[c],u[c+1]=1e3*n/o;u[0]=1e3*l[0]/(i[1].time-i[0].time),u[s-1]=1e3*(l[s-1]-l[s-3])/(i[s-1].time-i[s-3].time),this._timeArr=r,this.speedArr=u,this.gpx=t,this._data=null,this._dataAsKmPreHour=null,this._dataAsMinutePerKm=null,this._polyline=null,this._stats=null}ve.prototype.getData=function(){if(null===this._data){const e=this._timeArr,t=this.speedArr,n=e.length;let o=new Array(n);for(let a=0;a<n;a++)o[a]={value:[e[a],t[a]]};this._data=o}return this._data},ve.prototype.getDataAsKmPreHour=function(){if(null===this._dataAsKmPreHour){const e=this._timeArr,t=this.speedArr,n=e.length;let o=new Array(n);for(let a=0;a<n;a++)o[a]={value:[e[a],3.6*t[a]]};this._dataAsKmPreHour=o}return this._dataAsKmPreHour},ve.prototype.getDataAsMinutePerKm=function(){if(null===this._dataAsMinutePerKm){const e=this._timeArr,t=this.speedArr,n=e.length,o=e[e.length-1]-e[0],a=this.gpx.tracks[0].distance.total,l=o/(60*a);let i,r,s=new Array(n);for(let u=0;u<n;u++)t[u]<.2?(i=u>1&&u<n-2?t.slice(u-2,u+2):1===u||u===n-2?t.slice(u-1,u+1):0===u?t.slice(0,2):t.slice(n-2,n),r=50/(3*fe(i))):r=50/(3*t[u]),r>3*l&&(r=0),s[u]={value:[e[u],r]};this._dataAsMinutePerKm=s}return this._dataAsMinutePerKm},ve.prototype.toPolyline=function(){if(null===this._polyline){const e=this.gpx.tracks[0].points,t=e.length;let n,o=new Array(t);for(let a=0;a<t;a++)n=e[a],o[a]=[n.lat,n.lon];this._polyline=o}return this._polyline},ve.prototype.getTimeArr=function(){return this._timeArr},ve.prototype.getStats=function(){if(null===this._stats){let e={};const t=this._timeArr.length,n=this.gpx.tracks[0].points[t-1].time-this.gpx.tracks[0].points[0].time;e.numPoints=t,e.totalTime=he(n),e.totalDistance=this.gpx.tracks[0].distance.total.toFixed();const o=1e3*e.totalDistance/n,a=3.6*o,l=1e3/o;e.meanSpeed=[o.toFixed(2)+"m/s",a.toFixed(2)+"km/h",l.toFixed(0)+"sec/km"],console.log(e.meanSpeed),this._stats=e}return this._stats};var be=ve,ye={setup(e){(0,a.JJ)(ee.bw,"light"),te.D([ne.N,oe.N,ae.N,le.N,ie.N,re.N,se.N,ue.N,me.N,ce.z]);let t,n,o,i,r,s=1,u={title:{text:"GPXbox",left:"center"},tooltip:{trigger:"axis",formatter:e=>{e=e[0].data;let t=ge(e.value[0]);return`<p>${t}<br/>${e.value[1].toFixed(2)}</p>`},axisPointer:{type:"cross",animation:!0,snap:!0}},xAxis:{type:"time",splitLine:{show:!1},boundaryGap:!1},yAxis:{type:"value",scale:!0,boundaryGap:["0%","0%"],splitNumber:2},toolbox:{show:!0,feature:{saveAsImage:{}}},dataZoom:[{type:"slider",xAxisIndex:0,filterMode:"filter"},{type:"slider",yAxisIndex:0,filterMode:"none",left:"92%"}],series:[{type:"line",smooth:!0,showSymbol:!1,markLine:{symbol:"none",data:[{symbol:"circle",label:{position:"end",backgroundColor:"rgba(143,243,192,0.5)",borderRadius:[4,4,4,4],padding:[5,5,5,5],formatter:e=>ge(e.data.coord[0])},xAxis:0},{symbol:"circle",yAxis:0,label:{position:"start",backgroundColor:"rgba(143,243,192,0.75)",borderRadius:[4,4,4,4],padding:[5,5,5,5],formatter:"{c} m/s"}}]},markPoint:{data:[],symbol:"circle",label:{show:!1},symbolSize:6,itemStyle:{color:"rgba(255, 0, 0, 1)"}}}]},c=(0,l.iH)(u);const m=(0,l.iH)();(0,a.bv)((()=>{}));const p=(0,a.FN)().appContext.config.globalProperties;let d=[];function f(e){const a=new FileReader;a.readAsText(e,"utf-8"),a.onload=()=>{for(let t=0,n=d.length;t<n;t++)clearTimeout(d[t]);t=new be(a.result),n=0,o=t.getData(),c.value.series[0].data=o;let e=t.getTimeArr();r=o.length,i=new Array(r);for(let t=0;t<r;t++)i[t]=e[t+1]-e[t];i[r-1]=0,p.$bus.$emit("sendPolyline",{polyline:t.toPolyline(),timeDelta:i}),p.$bus.$emit("statsData",t.getStats())}}return p.$bus.$on("fileRead",f),p.$bus.$on("fileTitleRead",(e=>{c.value.title.text=e})),p.$bus.$on("speedRatioChanged",(e=>{s=e})),p.$bus.$on("play",(()=>{let e=()=>{n<r-1&&(c.value.series[0].markLine.data[0].xAxis=o[n].value[0],c.value.series[0].markLine.data[1].yAxis=o[n].value[1],c.value.series[0].markPoint.data[0]={coord:o[n].value},d.push(setTimeout(e,i[n]/s)),n++)};d.push(setTimeout(e,0))})),p.$bus.$on("pause",(()=>{for(let e=0,t=d.length;e<t;e++)clearTimeout(d[e])})),p.$bus.$on("backToStart",(()=>{n=0,c.value.series[0].markLine.data[0].xAxis=o[0].value[0],c.value.series[0].markLine.data[1].yAxis=o[0].value[1],c.value.series[0].markPoint.data[0]={coord:o[0].value}})),p.$bus.$on("unitOfSpeedChanged",(e=>{0===e?(o=t.getData(),c.value.series[0].markLine.data[1].label.formatter="{c} m/s"):1===e?(o=t.getDataAsKmPreHour(),c.value.series[0].markLine.data[1].label.formatter="{c} km/h"):2===e?(o=t.getDataAsMinutePerKm(),c.value.series[0].markLine.data[1].label.formatter=e=>{let t=Math.trunc(e.data.value),n=Math.trunc(60*(e.data.value-t));return n<10&&(n="0"+n),t+":"+n}):console.log(e),c.value.series[0].data=o})),(e,t)=>((0,a.wg)(),(0,a.j4)((0,l.SU)(ee.ZP),{ref_key:"chart",ref:m,autoresize:!0,option:(0,l.SU)(c)},null,8,["option"]))}};const Se=ye;var Ue=Se,we=n(3838);const xe={id:"container-up-down"},$e={id:"container-left-right"};var ke={setup(e){return(e,t)=>((0,a.wg)(),(0,a.j4)((0,l.SU)(we.Z),null,{default:(0,a.w5)((()=>[(0,a._)("div",xe,[(0,a._)("div",$e,[(0,a.Wm)((0,l.SU)(m),{id:"map"}),(0,a.Wm)((0,l.SU)(V),{id:"panel",ref:"panel"},null,512)]),(0,a.Wm)((0,l.SU)(Ue),{id:"map-charts"})])])),_:1}))}};const _e=ke;var Pe=_e,Ae=n(1373);const Ze=(0,Ae.Z)(),We={};We.$on=Ze.on,We.$off=Ze.off,We.$emit=Ze.emit;var De=We;const Te=(0,o.ri)(Pe);Te.config.globalProperties.$bus=De,Te.mount("#app")}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var l=t[o]={exports:{}};return e[o].call(l.exports,l,l.exports,n),l.exports}n.m=e,function(){var e=[];n.O=function(t,o,a,l){if(!o){var i=1/0;for(c=0;c<e.length;c++){o=e[c][0],a=e[c][1],l=e[c][2];for(var r=!0,s=0;s<o.length;s++)(!1&l||i>=l)&&Object.keys(n.O).every((function(e){return n.O[e](o[s])}))?o.splice(s--,1):(r=!1,l<i&&(i=l));if(r){e.splice(c--,1);var u=a();void 0!==u&&(t=u)}}return t}l=l||0;for(var c=e.length;c>0&&e[c-1][2]>l;c--)e[c]=e[c-1];e[c]=[o,a,l]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var a,l,i=o[0],r=o[1],s=o[2],u=0;if(i.some((function(t){return 0!==e[t]}))){for(a in r)n.o(r,a)&&(n.m[a]=r[a]);if(s)var c=s(n)}for(t&&t(o);u<i.length;u++)l=i[u],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(c)},o=self["webpackChunkgpxbox"]=self["webpackChunkgpxbox"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(533)}));o=n.O(o)})();
//# sourceMappingURL=app.b1f461cf.js.map