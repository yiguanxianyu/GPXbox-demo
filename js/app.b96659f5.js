(function(){"use strict";var t={3319:function(t,e,n){var o=n(9242),a=n(3396),l=n(4870),r=n(3153),i=n.n(r);n(8847);const s={id:"map"};var u={setup(t){let e,n,o,l,r,u,c,m,p=1,d=[];const f=()=>{e=i().map("map",{center:[39.99,116.303],zoom:15,attributionControl:!1})},g=t=>{i().control.scale({maxWidth:100,metric:!0,imperial:!1}).addTo(t)},h=t=>{let e="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";i().tileLayer(e,{minZoom:7,maxZoom:19}).addTo(t)},v=()=>{},y=(0,a.FN)().appContext.config.globalProperties;return y.$bus.$on("fileRead",v),y.$bus.$on("speedRatioChanged",(t=>{p=t})),y.$bus.$on("sendPolyline",(t=>{n.setLatLngs(t.polyline),o.setPaths(t.polyline),e.fitBounds(n.getBounds()),void 0===r?r=i().polyline([{lat:t.polyline[0][0],lon:t.polyline[0][1]}],{smoothFactor:.5,weight:4,color:"#ff6500"}).addTo(e):r.setLatLngs([{lat:t.polyline[0][0],lon:t.polyline[0][1]}]),l=0,u=t.polyline.length,m=t.timeDelta;let a=new Array(u);for(let e=0;e<u;e++){let n=t.polyline[e];a[e]={lat:n[0],lon:n[1]}}c=a})),y.$bus.$on("play",(()=>{let t=()=>{l<u-1&&(r.addLatLng(c[l]),d.push(setTimeout(t,m[l]/p)),l++)};d.push(setTimeout(t,0))})),y.$bus.$on("pause",(()=>{for(let t=0,e=d.length;t<e;t++)clearTimeout(d[t])})),y.$bus.$on("backToStart",(()=>{l=0;let t=r.getLatLngs()[0];r.setLatLngs([t])})),(0,a.bv)((()=>{f(),g(e),h(e),n=i().polyline([],{smoothFactor:.5,weight:4,color:"#00ad53"}).addTo(e),o=i().polylineDecorator([],{patterns:[{repeat:50,symbol:i().Symbol.arrowHead({pixelSize:5,headAngle:75,polygon:!1,pathOptions:{stroke:!0,weight:2,color:"#f5f5dc"}})}]}).addTo(e)})),(t,e)=>((0,a.wg)(),(0,a.iD)("div",s))}};const c=u;var m=c,p=n(7139),d=n(7238),f=n(235);const g=(0,a.Uk)("打开 GPX");var h={setup(t){let e=(0,l.iH)(null);const n=(0,a.FN)().appContext.config.globalProperties,o=({file:t})=>(n.$bus.$emit("fileRead",t.file),n.$bus.$emit("fileTitleRead",t.file.name),!1);return(t,n)=>((0,a.wg)(),(0,a.j4)((0,l.SU)(d.Z),{ref_key:"uploader",ref:e,accept:".gpx",max:1,onBeforeUpload:o},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(f.Z),{color:"#149D1F",primary:"",strong:""},{default:(0,a.w5)((()=>[g])),_:1})])),_:1},512))}};const v=h;var y=v,b=n(4722),S=n(1176),U=n(2505),w=n(9163),$=n(4299),x=n(7541),k=n(4470),_=n(5672),A=n(4567),P=n(9398),Z=n(301),W=n(4786),D=n(1260),T=n(2703),L=n(6296),C=n(3144),H=n(3645),M=n(8491),O=n(7108),j=n(5210),F=n(8870);const N=(0,a.Uk)("  播放 "),K=(0,a.Uk)("  暂停 "),z=(0,a.Uk)("  倒放 "),R=(0,a.Uk)("  回到起点 "),G=(0,a.Uk)("  速度单位 "),I=(0,a.Uk)(" 倍速 "),B=(0,a.Uk)(" 允许设置的倍速范围为 0.1 ~ 5 "),X=(0,a.Uk)("总里程"),E=(0,a.Uk)("总时间"),J=(0,a.Uk)("平均速度"),Y=(0,a.Uk)("记录点数量");var q={setup(t){const e=t=>()=>(0,a.h)(W.g,null,{default:()=>(0,a.h)(t)});let n,o,r=0;const i=(0,l.iH)(),s=(0,l.iH)(500),u=(0,l.iH)(),c=(0,l.iH)(),m=(0,l.iH)(),d=(0,l.iH)(),g=(0,D.U)(),h=e(b.Z),v=(0,a.FN)().appContext.config.globalProperties;v.$bus.$on("statsData",(t=>{o=t,o.totalDistance>=1e4?u.value=(o.totalDistance/1e3).toFixed(2)+"km":u.value=o.totalDistance+"m",c.value=o.totalTime,d.value=o.numPoints,n=o.meanSpeed,m.value=n[r]}));const q=(0,l.iH)([{label:"m/s",key:0,icon:h},{label:"km/h",key:1},{label:"min/km (Experimental)",key:2}]);function Q(t){for(let e=0;e<3;e++)q.value[e].icon=null;q.value[t].icon=h,v.$bus.$emit("unitOfSpeedChanged",t),m.value=n[t]}function V(t){null!==t&&(v.$bus.$emit("speedRatioChanged",t),g.info("调整为"+t+"倍速"),i.value=t)}function tt(){v.$bus.$emit("play")}function et(){v.$bus.$emit("pause")}function nt(){v.$bus.$emit("backToStart")}return(t,e)=>((0,a.wg)(),(0,a.j4)((0,l.SU)(T.Z),{justify:"space-around",vertical:""},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(L.ZP),{id:"title",bordered:!1,"header-style":"font-size:2.5em",title:"GPXbox"}),(0,a.Wm)((0,l.SU)(T.Z),{justify:"space-evenly"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(y)),(0,a.Wm)((0,l.SU)(f.Z),{secondary:"",strong:"",onClick:tt},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(S.Z)},null,8,["component"]),N])),_:1}),(0,a.Wm)((0,l.SU)(f.Z),{secondary:"",strong:"",onClick:et},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(U.Z)},null,8,["component"]),K])),_:1})])),_:1}),(0,a.Wm)((0,l.SU)(T.Z),{justify:"space-evenly"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(f.Z),{secondary:"",strong:"",onClick:tt},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(w.Z)},null,8,["component"]),z])),_:1}),(0,a.Wm)((0,l.SU)(f.Z),{secondary:"",strong:"",onClick:nt},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)($.Z)},null,8,["component"]),R])),_:1}),(0,a.Wm)((0,l.SU)(C.Z),{options:q.value,trigger:"hover",onSelect:Q},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(f.Z),{secondary:"",strong:""},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(x.Z)},null,8,["component"]),G])),_:1})])),_:1},8,["options"])])),_:1}),(0,a.Wm)((0,l.SU)(H.Z),{trigger:"hover"},{trigger:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(M.Z),{id:"inputNumber","default-value":1,max:5,min:.1,value:i.value,"onUpdate:value":V},{suffix:(0,a.w5)((()=>[I])),prefix:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(k.Z),depth:1},null,8,["component"])])),_:1},8,["min","value"])])),default:(0,a.w5)((()=>[B])),_:1}),(0,a.Wm)((0,l.SU)(O.Z),{cols:2,"x-gap":"4"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(j.ZP),{class:"statsLabel"},{default:(0,a.w5)((()=>[X])),_:1}),(0,a.Wm)((0,l.SU)(j.ZP),{class:"statsLabel"},{default:(0,a.w5)((()=>[E])),_:1}),(0,a.Wm)((0,l.SU)(j.ZP),{class:"statsData"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(_.Z)},null,8,["component"]),(0,a.Uk)(" "+(0,p.zw)(u.value),1)])),_:1}),(0,a.Wm)((0,l.SU)(j.ZP),{class:"statsData"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(A.Z)},null,8,["component"]),(0,a.Uk)(" "+(0,p.zw)(c.value),1)])),_:1}),(0,a.Wm)((0,l.SU)(j.ZP),{class:"statsLabel"},{default:(0,a.w5)((()=>[J])),_:1}),(0,a.Wm)((0,l.SU)(j.ZP),{class:"statsLabel"},{default:(0,a.w5)((()=>[Y])),_:1}),(0,a.Wm)((0,l.SU)(j.ZP),{class:"statsData"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(P.Z)},null,8,["component"]),(0,a.Uk)(" "+(0,p.zw)(m.value),1)])),_:1}),(0,a.Wm)((0,l.SU)(j.ZP),{class:"statsData"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,l.SU)(W.g),{component:(0,l.SU)(Z.Z)},null,8,["component"]),(0,a.Uk)(" "+(0,p.zw)(d.value),1)])),_:1})])),_:1}),(0,a.Wm)((0,l.SU)(F.Z),{id:"slider",value:s.value,"onUpdate:value":e[0]||(e[0]=t=>s.value=t),"format-tooltip":t=>t/10+"%",max:1e3,step:1,placement:"bottom"},null,8,["value","format-tooltip"])])),_:1}))}};const Q=q;var V=Q,tt=n(3215),et=n(8720),nt=n(5977),ot=n(7031),at=n(6069),lt=n(9483),rt=n(7309),it=n(542),st=n(2015),ut=n(7103),ct=n(5381),mt=n(7049),pt=n(1068),dt=n.n(pt);function ft(t){const e=new Date(t);let n=e.getFullYear(),o=e.getMonth()+1,a=e.getDate(),l=e.getHours(),r=e.getMinutes(),i=e.getSeconds();return o=o>9?o:"0"+o,a=a>9?a:"0"+a,l=l>9?l:"0"+l,r=r>9?r:"0"+r,i=i>9?i:"0"+i,`${n}-${o}-${a} ${l}:${r}:${i}`}function gt(t){t/=1e3;const e=parseInt(t/3600),n=parseInt(t/60%60),o=Math.ceil(t%60),a=e<10?"0"+e:e,l=o>59?59:o;return`${a>0?`${a}:`:""}${n<10?"0"+n:n}:${l<10?"0"+l:l}`}function ht(t){let e=new(dt());e.parse(t);let n=e.tracks[0],o=n.distance.cumul,a=n.points,l=a.map((t=>+t.time));const r=o.length;let i,s,u=new Array(r+10),c=new Array(r+10),m=new Array(r);for(let p=0;p<5;p++)u[p]=0,c[p]=l[0];for(let p=5;p<r+5;p++)u[p]=o[p-5],c[p]=l[p-5];for(let p=r+5;p<r+10;p++)u[p]=o[r-1],c[p]=l[r-1];for(let p=0;p<r;p++)i=u[p+10]-u[p],s=c[p+10]-c[p],m[p]=1e3*i/s;this._timeArr=l,this.speedArr=m,this.gpx=e,this._data=null,this._dataAsKmPreHour=null,this._dataAsMinutePerKm=null,this._polyline=null,this._stats=null}ht.prototype.getData=function(){if(null===this._data){const t=this._timeArr,e=this.speedArr,n=t.length;let o=new Array(n);for(let a=0;a<n;a++)o[a]={value:[t[a],e[a]]};this._data=o}return this._data},ht.prototype.getDataAsKmPreHour=function(){if(null===this._dataAsKmPreHour){const t=this._timeArr,e=this.speedArr,n=t.length;let o=new Array(n);for(let a=0;a<n;a++)o[a]={value:[t[a],3.6*e[a]]};this._dataAsKmPreHour=o}return this._dataAsKmPreHour},ht.prototype.getDataAsMinutePerKm=function(){if(null===this._dataAsMinutePerKm){const t=this._timeArr,e=t.length,n=new Array(e+10).fill(0);for(let s=5;s<e+5;s++)n[s]=this.speedArr[s];const o=t[t.length-1]-t[0],a=this.gpx.tracks[0].distance.total,l=o/(60*a);let r,i=new Array(e);for(let s=0;s<e;s++)r=50/(3*n[s]),r>3*l&&(r=0),i[s]={value:[t[s],r]};this._dataAsMinutePerKm=i}return this._dataAsMinutePerKm},ht.prototype.toPolyline=function(){if(null===this._polyline){const t=this.gpx.tracks[0].points,e=t.length;let n,o=new Array(e);for(let a=0;a<e;a++)n=t[a],o[a]=[n.lat,n.lon];this._polyline=o}return this._polyline},ht.prototype.getTimeArr=function(){return this._timeArr},ht.prototype.getStats=function(){if(null===this._stats){let t={};const e=this._timeArr.length,n=this.gpx.tracks[0].points[e-1].time-this.gpx.tracks[0].points[0].time;t.numPoints=e,t.totalTime=gt(n),t.totalDistance=this.gpx.tracks[0].distance.total.toFixed();const o=1e3*t.totalDistance/n,a=3.6*o,l=1e3/o;t.meanSpeed=[o.toFixed(2)+"m/s",a.toFixed(2)+"km/h",gt(1e3*l)+"/km"],console.log(t.meanSpeed),this._stats=t}return this._stats};var vt=ht,yt={setup(t){(0,a.JJ)(tt.bw,"light"),et.D([nt.N,ot.N,at.N,lt.N,rt.N,it.N,st.N,ut.N,mt.N,ct.z]);let e,n,o,r,i,s=1,u={title:{text:"GPXbox",left:"center"},tooltip:{trigger:"axis",formatter:t=>{t=t[0].data;let e=ft(t.value[0]);return`<p>${e}<br/>${t.value[1].toFixed(2)}</p>`},axisPointer:{type:"cross",animation:!0,snap:!0}},xAxis:{type:"time",splitLine:{show:!1},boundaryGap:!1},yAxis:{type:"value",scale:!0,boundaryGap:["0%","0%"],splitNumber:2},toolbox:{show:!0,feature:{saveAsImage:{}}},dataZoom:[{type:"slider",xAxisIndex:0,filterMode:"filter"},{type:"slider",yAxisIndex:0,filterMode:"none",left:"92%"}],series:[{type:"line",smooth:!0,showSymbol:!1,markLine:{symbol:"none",data:[{symbol:"circle",label:{position:"end",backgroundColor:"rgba(143,243,192,0.5)",borderRadius:[4,4,4,4],padding:[5,5,5,5],formatter:t=>ft(t.data.coord[0])},xAxis:0},{symbol:"circle",yAxis:0,label:{position:"start",backgroundColor:"rgba(143,243,192,0.75)",borderRadius:[4,4,4,4],padding:[5,5,5,5],formatter:"{c} m/s"}}]},markPoint:{data:[],symbol:"circle",label:{show:!1},symbolSize:6,itemStyle:{color:"rgba(255, 0, 0, 1)"}}}]},c=(0,l.iH)(u);const m=(0,l.iH)();(0,a.bv)((()=>{}));const p=(0,a.FN)().appContext.config.globalProperties;let d=[];function f(t){const a=new FileReader;a.readAsText(t,"utf-8"),a.onload=()=>{for(let e=0,n=d.length;e<n;e++)clearTimeout(d[e]);e=new vt(a.result),n=0,o=e.getData(),c.value.series[0].data=o;let t=e.getTimeArr();i=o.length,r=new Array(i);for(let e=0;e<i;e++)r[e]=t[e+1]-t[e];r[i-1]=0,p.$bus.$emit("sendPolyline",{polyline:e.toPolyline(),timeDelta:r}),p.$bus.$emit("statsData",e.getStats())}}return p.$bus.$on("fileRead",f),p.$bus.$on("fileTitleRead",(t=>{c.value.title.text=t})),p.$bus.$on("speedRatioChanged",(t=>{s=t})),p.$bus.$on("play",(()=>{let t=()=>{n<i-1&&(c.value.series[0].markLine.data[0].xAxis=o[n].value[0],c.value.series[0].markLine.data[1].yAxis=o[n].value[1],c.value.series[0].markPoint.data[0]={coord:o[n].value},d.push(setTimeout(t,r[n]/s)),n++)};d.push(setTimeout(t,0))})),p.$bus.$on("pause",(()=>{for(let t=0,e=d.length;t<e;t++)clearTimeout(d[t])})),p.$bus.$on("backToStart",(()=>{n=0,c.value.series[0].markLine.data[0].xAxis=o[0].value[0],c.value.series[0].markLine.data[1].yAxis=o[0].value[1],c.value.series[0].markPoint.data[0]={coord:o[0].value}})),p.$bus.$on("unitOfSpeedChanged",(t=>{0===t?(o=e.getData(),c.value.series[0].markLine.data[1].label.formatter="{c} m/s"):1===t?(o=e.getDataAsKmPreHour(),c.value.series[0].markLine.data[1].label.formatter="{c} km/h"):2===t?(o=e.getDataAsMinutePerKm(),c.value.series[0].markLine.data[1].label.formatter=t=>{let e=Math.trunc(t.data.value),n=Math.trunc(60*(t.data.value-e));return n<10&&(n="0"+n),e+":"+n}):console.log(t),c.value.series[0].data=o})),(t,e)=>((0,a.wg)(),(0,a.j4)((0,l.SU)(tt.ZP),{ref_key:"chart",ref:m,autoresize:!0,option:(0,l.SU)(c)},null,8,["option"]))}};const bt=yt;var St=bt,Ut=n(3838);const wt={id:"container-up-down"},$t={id:"container-left-right"};var xt={setup(t){return(t,e)=>((0,a.wg)(),(0,a.j4)((0,l.SU)(Ut.Z),null,{default:(0,a.w5)((()=>[(0,a._)("div",wt,[(0,a._)("div",$t,[(0,a.Wm)((0,l.SU)(m),{id:"map"}),(0,a.Wm)((0,l.SU)(V),{id:"panel",ref:"panel"},null,512)]),(0,a.Wm)((0,l.SU)(St),{id:"map-charts"})])])),_:1}))}};const kt=xt;var _t=kt,At=n(1373);const Pt=(0,At.Z)(),Zt={};Zt.$on=Pt.on,Zt.$off=Pt.off,Zt.$emit=Pt.emit;var Wt=Zt;const Dt=(0,o.ri)(_t);Dt.config.globalProperties.$bus=Wt,Dt.mount("#app")}},e={};function n(o){var a=e[o];if(void 0!==a)return a.exports;var l=e[o]={exports:{}};return t[o].call(l.exports,l,l.exports,n),l.exports}n.m=t,function(){var t=[];n.O=function(e,o,a,l){if(!o){var r=1/0;for(c=0;c<t.length;c++){o=t[c][0],a=t[c][1],l=t[c][2];for(var i=!0,s=0;s<o.length;s++)(!1&l||r>=l)&&Object.keys(n.O).every((function(t){return n.O[t](o[s])}))?o.splice(s--,1):(i=!1,l<r&&(r=l));if(i){t.splice(c--,1);var u=a();void 0!==u&&(e=u)}}return e}l=l||0;for(var c=t.length;c>0&&t[c-1][2]>l;c--)t[c]=t[c-1];t[c]=[o,a,l]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,o){var a,l,r=o[0],i=o[1],s=o[2],u=0;if(r.some((function(e){return 0!==t[e]}))){for(a in i)n.o(i,a)&&(n.m[a]=i[a]);if(s)var c=s(n)}for(e&&e(o);u<r.length;u++)l=r[u],n.o(t,l)&&t[l]&&t[l][0](),t[l]=0;return n.O(c)},o=self["webpackChunkgpxbox"]=self["webpackChunkgpxbox"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(3319)}));o=n.O(o)})();
//# sourceMappingURL=app.b96659f5.js.map